# 关于一张图动态图层的思考


## 现有的逻辑

- 用户在 `/mapConfig` - `资源图层` 上配置全部的图层内容(一级是什么，二级是什么)
- 在租户上 `/isys/tenant` 配置一张图最终展示的图层数据。
- 前端调用对应点位接口对所有的点位进行存储。由前端来掌控图标的显隐。

## 现存在的问题

- 一张图图层 `icon` 图标和点位图标都是写死的。
- 点位弹框所展示的文字内容前端写死。比如：警员窗体要展示哪些数据：姓名、警号、类别等等；设备要展示哪些数据：设备名称、设备编码等等。
- 点位和图层 key 由前后端开发自主定义。
- `资源图层` 和 `租户/isys/tenant` 开发起来好像没用上去。

## 解决思路

### 1、资源图层

- 按现在的思路做，剔除 `是否启用` 的标识。
- 在新增图层时，增加一个字段 `配置名称` 用来区分资源图层树上显示的文字和图层上面的文字。比如：可以建 `预警(治安)、预警(交警)` 解偶出来，一张图图层上都是显示预警。
- 图层的 `code` 都由用户自行配置。(这个code 组长要存档一份，到时候将这份文档发给运维，无法做到用户自行配置 key)
- 这个树建议可以编辑，现在好像新增完就没了。
- 针对点标记窗体内容。在这里做个弹框配置。每一行内容的标题和对应的key。
- 这里也增加对应的 `icon` 和点位图标。运维自己在 `minio` 上上传对应的图标，将图片路径增加上去即可。

### 2、租户管理

在租户模块就不需要用户去进行配置，一级图层是什么，二级图层是什么。

展示一级层级的列表，让用户勾选该租户要展示哪些数据。只允许勾选一级。如果有不满足的场景，让用户重新回到 `资源图层` 新增对应的数据。

### 3、一张图

目前让一张图完全脱离开发并不是一件容易的事。但是我们可以尽可能的减少开发人员的开发时间。

比如：设备有36种类型，后端将每个类型的数组整理好给到前端。

前端要做的内容：每次调用接口拿到对应的对象，存到整个图层的大对象中即可。

按上述这种做法，扣掉第一步和第二步的配置内容。前端的开发时间仅仅只需要 `0.5~1h`